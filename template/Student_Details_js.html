<!-- _________________ INCLUDES _______________________ -->

<link rel="stylesheet" href="{{ global_App_Url }}/template/css/tinymce.css"> 

<script type="module">

$('body', 'html').off(); // Unbind everything since global listeners are used in this file. That's no problem since each view re-registers its "global listeners".

/* _______________________________ Initial Load _______________________________ */

if(wasLoaded["tinymce"] !== true) {

$.getScript('{{ global_App_Url }}/template/js/tinymce/tinymce.min.js')
    .done(function( script, textStatus ) {
        setTimeout(() => activateTinyMCE(), 500);
        wasLoaded["tinymce"] = true;
    })

} else {

activateTinyMCE();

}

/* _________________________________ TinyMCE __________________________________ */

function activateTinyMCE() { 


    tinymce.suffix = '.min'; // For Async Load, not required when <script> is used
    tinyMCE.baseURL = "{{ global_App_Url }}/template/js/tinymce";  // For Async Load, not required when <script> is used

    $(".tox").remove();
    tinymce.remove(); 

    tinymce.init({
        forced_root_block : "",
        forced_root_block : false, 
        force_br_newlines : false,
        mode : "specific_textareas",
        editor_selector : "mceEditor",
        editor_deselector : "mceNoEditor",
        plugins: 'autoresize table advlist autolink lists link image charmap print preview hr anchor pagebreak',
        directionality : 'de',
        language: 'de',
        nowrap : true,
        menubar: true,
        toolbar: true,
        paste_auto_cleanup_on_paste : true,
        paste_remove_styles: true,
        paste_remove_styles_if_webkit: true,
        resize: true,
        branding: false,
        content_css: '{{ global_App_Url }}/template/css/tinymce_iframe.css',

        init_instance_callback: function(editor) {
        editor.on('focusout', function(e) {
            tinyMCE.triggerSave();
        });

        editor.addShortcut("ctrl+s", "Custom Ctrl+S", "custom_ctrl_s");
            editor.addCommand("custom_ctrl_s", function() {
                tinyMCE.triggerSave();
        });

        }

    });

    /* Clean Up */

    $( "nav a" ).click(function() {
        $(".tox").remove();
        tinymce.remove(); 
    });

}

setTimeout( () => $( "iframe#schulnotenheft_ifr" ).attr( "scrolling", "no" ), 1000);

wasLoaded["student_details"] = true;

</script>